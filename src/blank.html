<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>TooNote</title>
	<style>
		div#preview{
			width:100%;
		}
	</style>
</head>
<body>
	<div id="preview"></div>
	<div id="toc"></div>
	<script>
		var ipc = require('ipc');
		ipc.on('loadCss', function(cssArr) {
			console.log('loadCss',cssArr);
			if(!Array.isArray(cssArr)) return;
			cssArr.forEach(function(css){
				var $link = document.createElement('link');
				$link.rel = 'stylesheet';
				$link.href = css;
				document.head.appendChild($link);
			});
		});
		ipc.on('loadJs', function(jsArr) {
			console.log('loadJs',jsArr);
			if(!Array.isArray(jsArr)) return;
			var loadedCount = 0;
			if(jsArr.length){
				jsArr.forEach(function(js){
					var $script = document.createElement('script');
					$script.src = js;
					document.head.appendChild($script);
					var callback = function(){
						loadedCount++;
						if(loadedCount === jsArr.length){
							window.doPageTask && doPageTask();
							window.ready = true;
						}
					};
					$script.onload = callback;
					$script.onerror = callback;
				});
			}else{
				setTimeout(function(){
					window.doPageTask && doPageTask();
					window.ready = true;
				},0);
			}
		});
		ipc.on('loadNote', function(note) {
			window.doPageTask = function(){
				var view = require('./view');
				view.renderPreview(note);
			}
			if(window.ready){
				window.doPageTask();
			}
		});

		// 关闭窗口
		document.addEventListener('keydown',function(e){
			var ctrlOrCmd = e.metaKey || e.ctrlKey;
			// CTRL+W
			if(ctrlOrCmd && e.keyCode === 87){
				window.close();
				return;
			}
		});
	</script>
</body>
</html>
